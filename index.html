<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Symulator Autobusu</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
      background: #f0f0f0;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    #next {
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>Symulator Przystanków</h1>
  <div id="status">Czekam na rozpoczęcie trasy...</div>
  <div id="next"></div>

  <script>
    const przystanki = [
      { czas: 0, nazwa: "Ocytko Taras (start)" },
      { czas: 17, nazwa: "Ocytko Wyjazd" },
      { czas: 28, nazwa: "Ocytko Szopa" },
      { czas: 40, nazwa: "Ocytko Garaż" },
      { czas: 47, nazwa: "Ocytko Taras (koniec)" }
    ];

    const statusDiv = document.getElementById("status");
    const nextDiv = document.getElementById("next");

    let startCzas = null;
    let tryb = "czekanie";
    let przystanekIndex = 0;

    function say(text) {
      const msg = new SpeechSynthesisUtterance("Następny przystanek: " + text);
      msg.lang = "pl-PL";
      msg.rate = 0.8; // wolniejsze mówienie
      window.speechSynthesis.speak(msg);
    }

    function znajdzNajblizszyStart() {
      const teraz = new Date();
      const min = teraz.getMinutes();
      const sek = teraz.getSeconds();
      const dodajMinuty = (min % 2 === 0 && sek < 60) ? 0 : (2 - min % 2);
      return new Date(
        teraz.getFullYear(),
        teraz.getMonth(),
        teraz.getDate(),
        teraz.getHours(),
        min + dodajMinuty,
        34,
        0
      ).getTime();
    }

    function aktualizuj() {
      const teraz = Date.now();

      if (tryb === "czekanie") {
        const czasStartu = znajdzNajblizszyStart();
        const doStartu = Math.floor((czasStartu - teraz) / 1000);

        if (doStartu <= 0) {
          tryb = "trasa";
          startCzas = Date.now();
          przystanekIndex = 0;
          say(przystanki[0].nazwa);
          statusDiv.innerText = "Przystanek: " + przystanki[0].nazwa;
        } else {
          statusDiv.innerText = `Czekam na start (${doStartu}s)...`;
          nextDiv.innerText = "";
        }

      } else if (tryb === "trasa") {
        const uplynelo = Math.floor((teraz - startCzas) / 1000);

        if (przystanekIndex + 1 < przystanki.length) {
          const kolejny = przystanki[przystanekIndex + 1];
          const doNastepnego = kolejny.czas - uplynelo;

          if (doNastepnego === 0) {
            przystanekIndex++;
            say(kolejny.nazwa);
            statusDiv.innerText = "Przystanek: " + kolejny.nazwa;
            nextDiv.innerText = "";
          } else if (doNastepnego > 0) {
            nextDiv.innerText = `Za ${doNastepnego}s: ${kolejny.nazwa}`;
          }

        } else {
          statusDiv.innerText = "Koniec trasy.";
          nextDiv.innerText = "";
          tryb = "czekanie";
        }
      }
    }

    setInterval(aktualizuj, 1000);
  </script>
</body>
</html>
